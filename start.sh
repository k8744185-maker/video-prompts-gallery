#!/bin/bash
# Find Streamlit's static folder
STREAMLIT_STATIC=$(python -c "import streamlit, os; print(os.path.join(os.path.dirname(streamlit.__file__), 'static'))")
STREAMLIT_INDEX="$STREAMLIT_STATIC/index.html"

echo "Patching Streamlit at: $STREAMLIT_STATIC"

# 1. Inject verification meta tags into <head> (NO AdSense script here - defer it)
sed -i 's|<head>|<head><meta name="google-site-verification" content="8MpJT70JgoawSi-Z8yz-ZOHphQiFAsmJTq2622M41Us"/><meta name="google-adsense-account" content="ca-pub-5050768956635718"/><meta name="description" content="Video Prompts Gallery - Free curated collection of professional AI video generation prompts for Runway ML, Pika Labs, and Stable Video Diffusion. Browse Nature, Urban, Cinematic, Sci-Fi, Fantasy, and Tamil Cinema prompt categories."/><meta name="keywords" content="AI video prompts, video generation, Runway ML prompts, Pika Labs, AI filmmaking, cinematic prompts, text to video"/><meta property="og:title" content="Video Prompts Gallery - AI Video Prompt Collection"/><meta property="og:description" content="Free curated collection of professional AI video generation prompts for creators and filmmakers."/><meta property="og:type" content="website"/><meta property="og:url" content="https://video-prompts-gallery.onrender.com/"/>|' "$STREAMLIT_INDEX"

# 2. Inject static publisher content + deferred AdSense into <body>
# This content is visible BEFORE Streamlit JS loads, so Google crawler sees real content
# AdSense script loads AFTER content is in the DOM
sed -i 's|<body>|<body><div id="publisher-content" style="max-width:800px;margin:0 auto;padding:2rem;font-family:sans-serif;"><h1 style="color:\#333;text-align:center;">üé¨ Video Prompts Gallery</h1><h2 style="color:\#555;text-align:center;font-size:1.2rem;font-weight:normal;">Free AI Video Generation Prompts for Creators</h2><div style="padding:1.5rem;margin:1rem 0;background:\#f8f9fa;border-radius:12px;border-left:4px solid \#667eea;"><h3 style="color:\#333;">About Video Prompts Gallery</h3><p style="color:\#555;line-height:1.8;">Video Prompts Gallery is a free, curated collection of professional-grade AI video generation prompts designed for filmmakers, content creators, and AI enthusiasts. Our handcrafted prompts help you create stunning videos using tools like Runway ML, Pika Labs, Stable Video Diffusion, and other text-to-video AI platforms.</p><p style="color:\#555;line-height:1.8;">Each prompt is carefully crafted with cinematic detail including specific camera angles, lighting conditions, atmospheric elements, and motion descriptions. Browse our 8+ categories: Nature, Urban, Cinematic, Sci-Fi, Fantasy, Abstract, Tamil Cinema, and more.</p></div><div style="padding:1.5rem;margin:1rem 0;"><h3 style="color:\#333;">How to Use AI Video Prompts</h3><p style="color:\#555;line-height:1.8;">Creating compelling AI-generated videos starts with a well-crafted prompt. Our prompts include specific visual details, camera movements, mood descriptions, and artistic references that maximize the quality of AI video output.</p><ul style="color:\#555;line-height:2;"><li><strong>Be Specific:</strong> Include colors, textures, lighting, and atmospheric elements for detailed results.</li><li><strong>Camera Movement:</strong> Specify dolly shots, pans, or aerial tracking for dynamic video output.</li><li><strong>Mood and Atmosphere:</strong> Use descriptive words like serene, dramatic, or ethereal to set the tone.</li><li><strong>Art References:</strong> Mention cinematic styles for the AI to understand your creative vision.</li></ul></div><div style="padding:1rem;text-align:center;color:\#888;font-size:0.9rem;"><p>¬© 2026 Video Prompts Gallery. Made with ‚ù§Ô∏è in India. Contact: k8744185@gmail.com</p><p><a href="/?tab=Privacy">Privacy Policy</a> | <a href="/?tab=Terms">Terms of Service</a> | <a href="/?tab=About">About Us</a> | <a href="/?tab=Contact">Contact</a></p></div></div><noscript><div style="max-width:800px;margin:0 auto;padding:2rem;font-family:sans-serif;"><h1>Video Prompts Gallery - AI Video Prompt Collection</h1><p>Video Prompts Gallery is a free, curated collection of professional AI video generation prompts for filmmakers and content creators. Browse prompts across Nature, Urban, Cinematic, Sci-Fi, Fantasy, and Tamil Cinema categories. Works with Runway ML, Pika Labs, Stable Video Diffusion, and other AI video tools.</p><p>Contact: k8744185@gmail.com</p></div></noscript><script>document.addEventListener("DOMContentLoaded",function(){var c=document.getElementById("publisher-content");if(c){var observer=new MutationObserver(function(mutations){var stApp=document.querySelector("[id^=root],.stApp,.main");if(stApp&&stApp.children.length>2){c.style.display="none";observer.disconnect();}});observer.observe(document.body,{childList:true,subtree:true});setTimeout(function(){c.style.display="none";},8000);}var s=document.createElement("script");s.async=true;s.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5050768956635718";s.crossOrigin="anonymous";setTimeout(function(){document.head.appendChild(s);},3000);});</script>|' "$STREAMLIT_INDEX"

# 3. Copy ads.txt to Streamlit's root static folder so it's served at /ads.txt
cp static/ads.txt "$STREAMLIT_STATIC/ads.txt"

# 4. Copy google verification file
cp static/google7b16d249e9588da5.html "$STREAMLIT_STATIC/google7b16d249e9588da5.html" 2>/dev/null || true

echo "Patches applied. Starting Streamlit..."

# Run Streamlit directly on Render's PORT
streamlit run app.py --server.port=$PORT --server.address=0.0.0.0
